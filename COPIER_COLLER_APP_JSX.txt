// ========================================
// CODE Ã€ COPIER-COLLER DANS src/App.jsx
// ========================================
// Remplacer le useEffect ligne 328 (celui qui contient onAuthStateChange)
// par ce code :

  // ðŸŸ£ 1 â€” GÃ©rer la session + Magic Link
  useEffect(() => {
    // ðŸ”¥ MAGIC LINK: Parser le hash dans l'URL pour extraire access_token
    const hash = window.location.hash;
    if (hash && hash.includes('access_token')) {
      const hashParams = new URLSearchParams(hash.substring(1));
      const accessToken = hashParams.get('access_token');
      const refreshToken = hashParams.get('refresh_token');
      
      if (accessToken && refreshToken) {
        console.log('ðŸ” [App.jsx] Magic Link dÃ©tectÃ© dans URL, activation session...');
        supabase.auth.setSession({ 
          access_token: accessToken, 
          refresh_token: refreshToken 
        }).then(({ data, error }) => {
          if (error) {
            console.error('âŒ Erreur setSession:', error);
          } else if (data.session) {
            console.log('âœ… Session activÃ©e:', data.session.user.email);
            setSession(data.session);
            // Nettoyer l'URL et rediriger
            window.history.replaceState({}, document.title, window.location.pathname + '#/dashboard');
          }
        });
        return; // Stopper l'exÃ©cution ici
      }
    }
    
    // Ã‰couter les changements d'auth
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session) => {
        console.log('ðŸ” [App.jsx] Auth event:', event);
        setSession(session ?? null);
      }
    );

    // Charger la session initiale
    supabase.auth.getSession().then(({ data }) => {
      console.log('ðŸ” [App.jsx] Session initiale:', data.session?.user?.email || 'aucune');
      setSession(data.session ?? null);
    });

    return () => subscription.unsubscribe();
  }, []);
