-- ğŸ”§ FIX: Ajouter panel_id manquants dans client_form_panels
-- ProblÃ¨me: Les anciens enregistrements n'ont peut-Ãªtre pas de panel_id

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 1ï¸âƒ£ VÃ‰RIFIER LES ENREGISTREMENTS SANS panel_id
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SELECT 
    id,
    prospect_id,
    project_type,
    form_id,
    panel_id,
    created_at
FROM client_form_panels
WHERE panel_id IS NULL
ORDER BY created_at DESC;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 2ï¸âƒ£ GÃ‰NÃ‰RER panel_id POUR LES ENREGISTREMENTS EXISTANTS
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âš ï¸ DÃ‰COMMENTER POUR EXÃ‰CUTER (aprÃ¨s avoir vÃ©rifiÃ© au-dessus)
/*
UPDATE client_form_panels
SET panel_id = CONCAT(
    'panel-',
    prospect_id,
    '-',
    project_type,
    '-',
    form_id,
    '-',
    EXTRACT(EPOCH FROM created_at)::bigint * 1000
)
WHERE panel_id IS NULL;
*/

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 3ï¸âƒ£ VÃ‰RIFIER LA STRUCTURE DE LA COLONNE panel_id
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SELECT 
    column_name,
    data_type,
    is_nullable,
    column_default,
    character_maximum_length
FROM information_schema.columns
WHERE table_schema = 'public'
AND table_name = 'client_form_panels'
AND column_name = 'panel_id';

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- 4ï¸âƒ£ RENDRE panel_id OBLIGATOIRE (si nÃ©cessaire)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âš ï¸ Ã€ exÃ©cuter APRÃˆS avoir gÃ©nÃ©rÃ© les panel_id manquants
/*
ALTER TABLE client_form_panels 
ALTER COLUMN panel_id SET NOT NULL;

-- Ajouter une contrainte unique sur panel_id
ALTER TABLE client_form_panels 
ADD CONSTRAINT client_form_panels_panel_id_key UNIQUE (panel_id);
*/
