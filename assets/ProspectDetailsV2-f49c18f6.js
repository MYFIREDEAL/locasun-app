import{c as N,u as y,r as u,j as e,B as b,a8 as v,a2 as f,a0 as d,a4 as w,M as p,p as C,t as k,ak as S,b9 as P,ba as M}from"./index-07c7b38f.js";import{l as V}from"./workflowV2Config-f801420c.js";import{u as T}from"./useSupabaseProjectStepsStatus-81095355.js";import{R as A}from"./rocket-5266bac5.js";const I=N("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),j={completed:{label:"Termin√©",icon:f,iconClass:"text-green-500",bgClass:"bg-green-50",textClass:"text-green-700"},in_progress:{label:"En cours",icon:P,iconClass:"text-blue-500 fill-blue-500",bgClass:"bg-blue-50",textClass:"text-blue-700"},pending:{label:"√Ä venir",icon:M,iconClass:"text-gray-300",bgClass:"bg-gray-50",textClass:"text-gray-500"}},O=({prospect:s})=>s?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-4",children:"Informations client"}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"h-7 w-7 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:s.name||"Client sans nom"}),e.jsxs("div",{className:"mt-3 space-y-2",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(p,{className:"h-4 w-4 text-gray-400"}),e.jsx("a",{href:`mailto:${s.email}`,className:"hover:text-blue-600",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(C,{className:"h-4 w-4 text-gray-400"}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-blue-600",children:s.phone})]}),s.address&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:s.address})]}),s.company_name&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(S,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:s.company_name})]})]})]})]})]}):null,$=({prospect:s,onOpenWorkflow:i})=>{const l=(s==null?void 0:s.tags)||[];return l.length===0?e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsx("h2",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-4",children:"Projets"}),e.jsx("p",{className:"text-gray-400 text-center py-4",children:"Aucun projet associ√©"})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-4",children:["Projets (",l.length,")"]}),e.jsx("div",{className:"space-y-3",children:l.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-900",children:a})]}),e.jsxs(b,{size:"sm",onClick:()=>i(a),className:"gap-2 bg-blue-600 hover:bg-blue-700",children:[e.jsx(A,{className:"h-4 w-4"}),"Ouvrir Workflow V2"]})]},a))})]})},L=({steps:s=[],projectType:i})=>{if(!s||s.length===0)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-4",children:["√âtapes ‚Äî ",i]}),e.jsx("p",{className:"text-gray-400 text-center py-4",children:"Aucune √©tape configur√©e"})]});const l=s.filter(n=>n.status==="completed").length,a=Math.round(l/s.length*100);return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide",children:["√âtapes ‚Äî ",i]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[l,"/",s.length," (",a,"%)"]})]}),e.jsx("div",{className:"h-2 bg-gray-100 rounded-full mb-6 overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-500",style:{width:`${a}%`}})}),e.jsx("div",{className:"space-y-3",children:s.map((n,c)=>{const x=n.status||"pending",t=j[x]||j.pending,m=t.icon;return e.jsxs("div",{className:d("flex items-center gap-3 p-3 rounded-lg",t.bgClass),children:[e.jsx("div",{className:d("flex-shrink-0",t.iconClass),children:e.jsx(m,{className:"h-5 w-5"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("p",{className:d("text-sm font-medium",t.textClass),children:[n.icon||"üìã"," ",n.name||`√âtape ${c+1}`]})}),e.jsx("span",{className:d("text-xs px-2 py-0.5 rounded-full",t.bgClass,t.textClass),children:t.label})]},n.id||c)})}),e.jsx("div",{className:"mt-4 p-3 bg-amber-50 rounded-lg border border-amber-200",children:e.jsxs("p",{className:"text-xs text-amber-700",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Mode lecture seule"}),' ‚Äî Les √©tapes sont affich√©es mais non modifiables ici. Utilisez le bouton "Ouvrir Workflow V2" pour interagir.']})})]})},E=({prospect:s,onClose:i})=>{var o,h,g;const l=y(),[a,n]=u.useState(((o=s==null?void 0:s.tags)==null?void 0:o[0])||null),{projectStepsStatus:c}=T(s==null?void 0:s.id,{enabled:!!(s!=null&&s.id)}),x=u.useMemo(()=>!a||!c?[]:c[a]||[],[c,a]),t=r=>{V("ProspectDetailsV2: Ouverture Workflow",{prospectId:s==null?void 0:s.id,projectType:r}),l(`/admin/workflow-v2/${s.id}/${r}`)},m=()=>{i?i():l("/admin/pipeline")};return s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4 sticky top-0 z-10",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{variant:"ghost",size:"icon",onClick:m,children:e.jsx(v,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-semibold text-gray-900",children:["Prospect ",e.jsx("span",{className:"text-blue-600",children:"V2"})]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.name," ‚Ä¢ ",(h=s.id)==null?void 0:h.slice(0,8),"..."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-medium",children:[e.jsx(f,{className:"h-4 w-4"}),"Version V2"]})]})}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{prospect:s}),e.jsx($,{prospect:s,onOpenWorkflow:t})]}),e.jsxs("div",{className:"space-y-6",children:[((g=s.tags)==null?void 0:g.length)>1&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border p-4",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Afficher les √©tapes pour :"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(r=>e.jsx("button",{onClick:()=>n(r),className:d("px-3 py-1.5 rounded-full text-sm font-medium transition-colors",a===r?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:r},r))})]}),a&&e.jsx(L,{steps:x,projectType:a})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Aucun prospect s√©lectionn√©"})})};export{E as default};
