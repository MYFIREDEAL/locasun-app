import{c as $,b as O,a as z,r as o,ad as A,ae as F,R,j as e,Z as _,$ as h,a1 as E,Y as V,aT as W}from"./index-2e60dbf1.js";import{I as q,M as Z}from"./ModuleConfigTab-f14a6f9e.js";import{u as J}from"./useSupabaseWorkflowModuleTemplates-4913653e.js";import"./workflowV2Config-f801420c.js";import"./rocket-63b4218a.js";import"./download-3361f682.js";const Y=$("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),D=()=>{var v,w,k;const{projectsData:m}=O(),{organizationId:g}=z(),[n,N]=o.useState(null),[a,y]=o.useState(null),{forms:f,loading:B}=A(g),{templates:d,loading:G}=F(g),x=J(g,null),S=o.useMemo(()=>f?Object.values(f).map(s=>({id:s.id,name:s.name||s.title||"Formulaire sans nom",fields:s.fields||[],audience:s.audience||"client"})):[],[f]),I=o.useMemo(()=>d?Array.isArray(d)?d.map(s=>({id:s.id,name:s.name||"Template sans nom"})):Object.values(d).map(s=>({id:s.id,name:s.name||"Template sans nom"})):[],[d]),c=o.useMemo(()=>m?Object.entries(m).filter(([s,t])=>{var l;return((l=t==null?void 0:t.steps)==null?void 0:l.length)>0}).sort(([s],[t])=>s.localeCompare(t)):[],[m]),b=o.useMemo(()=>{if(!x.templates||typeof x.templates!="object")return[];const s=Object.values(x.templates).map(t=>`${t.projectType}:${t.moduleId}`);return s.length>0&&console.log("[V2 ConfigPage] configuredModules:",JSON.stringify(s),"looking for:",`${n}:inscription`),s},[x.templates]);R.useEffect(()=>{c.length>0&&!n&&N(c[0][0])},[c,n]);const r=n?m[n]:null,j=(r==null?void 0:r.steps)||[],T=(s,t,l)=>{y({projectType:s,moduleId:t,step:l})},M=c.reduce((s,[t,l])=>{var i;return s+(((i=l==null?void 0:l.steps)==null?void 0:i.length)||0)},0);return e.jsxs("div",{className:"min-h-[calc(100vh-64px)] bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between max-w-screen-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl shadow-lg",children:e.jsx(_,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Workflow V2 â€” Configuration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configuration globale par type de projet"})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Types de projet"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-600",children:b.length}),e.jsx("p",{className:"text-xs text-gray-500",children:"Modules configurÃ©s"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:M}),e.jsx("p",{className:"text-xs text-gray-500",children:"Total modules"})]})]})]})}),e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"w-80 bg-white border-r flex-shrink-0 sticky top-0 self-start max-h-[calc(100vh-64px)] overflow-y-auto",children:[e.jsxs("div",{className:"border-b p-3 flex-shrink-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-2 px-1",children:"Type de projet"}),e.jsx("div",{className:"flex flex-wrap gap-1.5",children:c.map(([s,t])=>{const l=n===s,i=(t==null?void 0:t.steps)||[],u=i.filter(p=>{var C;const L=((C=p.name)==null?void 0:C.toLowerCase().replace(/[_\s]/g,"-").replace(/[^a-z0-9-]/g,""))||"";return b.includes(`${s}:${L}`)}).length;return e.jsxs("button",{onClick:()=>{N(s),y(null)},className:h("px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-2",l?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[e.jsx("span",{children:(t==null?void 0:t.icon)||"ðŸ“‹"}),e.jsx("span",{children:(t==null?void 0:t.title)||s}),e.jsxs("span",{className:h("text-xs px-1.5 py-0.5 rounded-full",l?"bg-white/20 text-white":"bg-gray-200 text-gray-600"),children:[u,"/",i.length]})]},s)})})]}),e.jsxs("div",{className:"overflow-y-auto flex-1",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider px-4 pt-3 pb-2",children:["Modules (",j.length,")"]}),j.length===0?e.jsxs("div",{className:"px-4 py-8 text-center text-gray-400",children:[e.jsx(Y,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Aucun module"})]}):e.jsx("div",{className:"space-y-1 px-2 pb-4",children:j.map((s,t)=>{var p;const l=((p=s.name)==null?void 0:p.toLowerCase().replace(/[_\s]/g,"-").replace(/[^a-z0-9-]/g,""))||`step-${t}`,i=b.includes(`${n}:${l}`),u=(a==null?void 0:a.moduleId)===l&&(a==null?void 0:a.projectType)===n;return e.jsxs("button",{onClick:()=>T(n,l,s),className:h("w-full px-3 py-3 rounded-lg text-left transition-all","flex items-center gap-3",u?"bg-blue-100 border-2 border-blue-500":"bg-gray-50 hover:bg-gray-100 border-2 border-transparent"),children:[e.jsx("span",{className:"text-xl flex-shrink-0",children:s.icon||"ðŸ“‹"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:h("text-sm font-medium truncate",u?"text-blue-900":"text-gray-800"),children:s.name||`Module ${t+1}`}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:s.description})]}),e.jsx("div",{className:"flex-shrink-0",children:i?e.jsx(E,{className:"h-5 w-5 text-emerald-500"}):e.jsx(V,{className:"h-5 w-5 text-amber-400"})})]},l)})})]})]}),e.jsx("div",{className:"flex-1",children:a?e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-3xl",children:((v=a.step)==null?void 0:v.icon)||"ðŸ“‹"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:((w=a.step)==null?void 0:w.name)||a.moduleId}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(r==null?void 0:r.title)||n," â€¢ Configuration globale"]})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-100 rounded-xl",children:e.jsxs("p",{className:"text-sm text-blue-700 flex items-start gap-2",children:[e.jsx(q,{className:"h-4 w-4 flex-shrink-0 mt-0.5"}),e.jsxs("span",{children:["Cette configuration s'applique Ã  ",e.jsxs("strong",{children:['tous les projets "',(r==null?void 0:r.title)||n,'"']})," de votre organisation."]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border p-6",children:e.jsx(Z,{moduleId:a.moduleId,moduleName:((k=a.step)==null?void 0:k.name)||a.moduleId,isReadOnly:!1,prospectId:null,projectType:a.projectType,availableForms:S,availableTemplates:I,templateOps:x})})]}):e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md px-6",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl flex items-center justify-center mx-auto mb-6",children:e.jsx(W,{className:"h-10 w-10 text-blue-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"SÃ©lectionnez un module"}),e.jsx("p",{className:"text-gray-500",children:"Choisissez un module dans la liste Ã  gauche pour configurer ses actions, formulaires, templates et comportement IA."})]})})})]})]})};export{D as default};
